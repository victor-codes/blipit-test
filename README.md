# Blip-It

Blip-It — Wallet Management System

## Features

- User authentication (sign up, sign in, OTP, sign out)
- Wallet creation and management
- Transaction processing
- Modular UI components with Radix UI and Tailwind CSS
- Supabase integration for database and authentication
- TypeScript for type safety
- Custom hooks and context providers for state management

## Tech Stack

- **Framework:** [Next.js](https://nextjs.org/) (App Router)
- **Language:** TypeScript, React 19
- **Styling:** Tailwind CSS, Radix UI
- **Backend:** Supabase (Postgres, Auth)
- **State Management:** React Context, TanStack React Query
- **Utilities:** Zod (validation), date-fns, clsx, etc.

## Project Structure

```
.
├── app/                # Next.js app directory (pages, layouts, API routes)
│   ├── api/            # Custom API endpoints (user, auth, etc.)
│   ├── (dashboard)/    # Dashboard routes
│   ├── auth/           # Auth-related pages
│   ├── setup/          # Setup flows
│   └── layout.tsx      # Root layout
├── components/         # Reusable UI components
│   ├── ui/             # UI primitives
│   ├── sections/       # Page sections
│   ├── svgs/           # SVG assets
│   └── hoc/            # Higher-order components
├── contexts/           # React context providers (wallets, dashboard, query client)
├── lib/                # Utility functions, constants, validation, Supabase clients
├── services/           # Business logic (wallets, transactions, user, auth)
├── types/              # TypeScript types and interfaces
├── public/             # Static assets (SVGs, favicon)
├── scripts/            # Utility scripts (e.g., typegen)
├── database.types.ts   # Database schema types (autogenerated)
├── next.config.ts      # Next.js configuration
├── package.json        # Project metadata and dependencies
└── README.md           # Project documentation
```

# Getting Started

## Step 1: Install Blnk

### Prerequisites

- Ensure you have **Docker** and **Docker Compose** installed and running on your machine.

### Installation Steps

1. **Clone the Blnk Repository**

   ```bash
   git clone https://github.com/blnkledger/blnk && cd blnk
   ```

2. **Create Configuration File**

   ```bash
   touch blnk.json
   ```

3. **Add Configuration**

   Populate `blnk.json` with the following content:

   ```json
   {
   "project_name": "Blnk",
   "data_source": {
    "dns": "postgres://postgres:password@postgres:5432/blnk?sslmode=disable"
   },
   "redis": {
    "dns": "redis:6379"
   },
   "server": {
    "port": "5001"


   }
   ```

4. **Start Blnk Server**

   ```bash
   docker compose up
   ```
   if successful, your server should be running on [http://localhost:5001/](http://localhost:5001/)

## Step 2: Create Your a Ledger

In Blnk, a ledger groups and manages balances. By default, a **General Ledger** is created during installation. To create additional ledgers:

### Using Blnk CLI

1. **Install Blnk CLI**

   ```bash
   npm install -g @blnkfinance/blnk-cli
   ```

2. **Create Ledger**

   ```bash
   blnk ledgers create --name "Wallet Management Account" --meta_data '{"project_owner":"YOUR_APP_NAME"}'
   ```

### Using API

Send a POST request to create a new ledger:

- **Endpoint**: `POST http://localhost:5001/ledgers`

- **Request Body**:

```json
{
  "name": "Customer Savings Account",
  "meta_data": {
    "project_owner": "YOUR_APP_NAME"
  }
}
```

- **Response**:

```json
{
  "ledger_id": "ldg_073f7ffe-9dfd-42ce-aa50-d1dca1788adc",
  "name": "Customer Savings Account",
  "created_at": "2024-12-21T01:36:46.997063436Z",
  "meta_data": {
    "project_owner": "YOUR_APP_NAME"
  }
}
```

This response confirms the successful creation of your ledger. Save the `ledger_id` in your env file

## Step 3: Database Migrations with Supabase

This project uses Supabase for database management. Database migrations are stored in the `supabase/migrations` directory.

### Running Migrations Locally

1. **Install Supabase CLI** (if not already installed):

   ```bash
   bun add -g supabase
   ```

2. **Start Supabase local instance**:

   ```bash
   supabase start
   ```


3. **Reset and apply migrations**:
   ```bash
   supabase db reset
   ```
   <!-- 3. **Apply pending migrations**:
      ```bash
      supabase db reset
      ``` -->

### Want to use your remote supabase project?

1. Make sure supabase is installed globally, if not, prepend you commands with your perferred package manager eg `bun run supabase .....`

2. Link your project

   ```bash
   supabase login
   supabase link --project-ref your-project-ref
   ```

   (Get your project ref from your Supabase project settings)

3. **Reset and apply migrations**:
   ```bash
   supabase db reset
   ```
4. **Push migrations**
   ```bash
   supabase db push
   ```

## Environment Variables

- `SUPABASE_URL` - Your Supabase project URL
- `SUPABASE_ANON_KEY` - Supabase anon/public key
- `BLNK_INSTANCE_API_URL` - Used for API rewrites in `next.config.ts`
- (See `.env.example` for all required variables)

## Scripts

- `dev` - Start development server
- `build` - Build for production
- `start` - Start production server
- `lint` - Run ESLint
- `typegen` - Generate types from database

## API Overview

Custom API routes are defined under `app/api/`:

- **Auth**

  - `POST /api/auth/signup` - Register a new user
  - `POST /api/auth/signin` - Sign in user
  - `POST /api/auth/signin/confirm-otp` - Confirm OTP for sign in
  - `POST /api/auth/signout` - Sign out user

- **User**
  - `GET/POST /api/user` - User profile actions
  - `POST /api/user/card/create` - Create a new card for user
  - `POST /api/user/setup` - Complete user setup

(See each `route.ts` for request/response details.)

## Database Schema

The database (see `database.types.ts`) includes:

- **profiles**: User profile data
- **cards**: User tokenized card details (card_number, etc.)

All types are strongly typed and available for import.

## Development Notes

- **UI Components:** Located in `components/`, organized by type and function.
- **Context Providers:** For global state (wallets, dashboard, query client).
- **Validation:** Zod schemas in `lib/validationSchema/`.
- **Supabase:** Client and server utilities in `lib/supabase/`.
- **API Rewrites:** Requests to `/blnk/:path*` are proxied to `BLNK_INSTANCE_API_URL` (see `next.config.ts`).
- **APP Currency:** Change `balanceFormatter` in utils if you are changing the currency

**For more details, see the codebase and inline comments.**
